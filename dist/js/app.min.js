"use strict";var app=angular.module("app",["angular-loading-bar","ngAnimate","ui.router","toastr","ui.bootstrap","schemaForm"]).run(["$rootScope","$state","$timeout","$location",function(t,e,o,n){console.log(" start app"),t.isLogin=sessionStorage.isLogin;var a=n.search();"login"===a.tmethod&&o(function(){e.go("home.login")})}]);angular.module("app").config(["$httpProvider","toastrConfig","$locationProvider",function(t,e,o){t.interceptors.push("authorInterceptor"),o.html5Mode({enabled:!0,requireBase:!0}),angular.extend(e,{timeOut:2e3})}]),angular.module("app").controller("ListController",["$rootScope","$http","$location","$stateParams","$scope","toastr","$state","$uibModal",function(t,e,o,n,a,r,i,s){function d(){e({url:"getLog",method:"POST"}).then(function(t){t.data.status?a.logs=t.data.model.logs.reverse():r.warning(t.data.msg)})}function l(){e({url:"getAllDocs",method:"POST"}).then(function(e){a.docs=e.data.model,e.data.logined?(sessionStorage.setItem("isLogin",!0),t.isLogin=sessionStorage.isLogin):(sessionStorage.setItem("isLogin",!1),t.isLogin=void 0),c()},function(t){})}function c(){a.docs.forEach(function(t){e({url:"getDocument",method:"POST",data:{name:t.name}}).then(function(e){e.data.status?(a.apis=e.data.model.apis,t.apiList=m(a.apis)):r.warning(e.data.msg)})})}function m(t){for(var e=[],o=0;o<t.length;o++)e.push({idx:o,name:t[o].name});return e}function u(){return!!(i.includes("home.edit")||i.includes("home.doc")||i.includes("home.newApi")||i.includes("home.error")||i.includes("home.editErr"))}a.docs=[],a.deleteDoc=function(){if(!u())return r.warning("请选中要删除的文档"),!1;var t=s.open({animation:!0,templateUrl:"confirm.html",controller:"delDocumentCtl",keyboard:!1,backdrop:"static"});t.result.then(function(t){t?e({url:"delDocument",method:"POST",data:{name:t}}).then(function(t){t.data.status?(l(),d(),i.go("home"),r.success(t.data.msg)):r.warning(t.data.msg)}):console.log("dismiss")})},a.editDoc=function(){if(!u())return r.warning("请选中要编辑的文档"),!1;console.log(i.includes("home.doc"));var t=s.open({animation:!0,templateUrl:"page/editDoc.html",keyboard:!1,controller:"editDocInfoCtrl",backdrop:"static"});t.result.then(function(t){location.reload()},function(t){})},l(),d(),a.logout=function(){e({url:"/logout",method:"POST"}).then(function(e){sessionStorage.clear(),t.isLogin=sessionStorage.isLogin,i.go("home")})}}]).controller("MainController",["$http","$scope","$stateParams","toastr","$state","$uibModal",function(t,e,o,n,a,r){e.apis=[],t({url:"getDocument",method:"POST",data:{name:o.docName}}).then(function(t){t.data.status?(e.apis.push(t.data.model.apis[o.apiIndex]),e.documentInfo=t.data.model.docInfo,e.documentInfo.index=o.apiIndex):n.warning(t.data.msg)}),e.delApi=function(e,i){var s=r.open({animation:!0,templateUrl:"confirm.html",controller:"delDocumentCtl",keyboard:!1,backdrop:"static"});s.result.then(function(e){e?t({url:"delApi",method:"POST",data:{index:o.apiIndex,name:i}}).then(function(t){n.success(t.data.msg),a.transitionTo("home.doc",{docName:o.docName,apiIndex:0},{reload:!0})},function(t){n.warning(t.data.msg)}):console.log("dismiss")})}}]).controller("NewDocumentController",["$scope","$http","toastr","$state",function(t,e,o,n){t.newDocument=function(){e({url:"newDocument",method:"POST",data:t.newDocs}).then(function(t){t.data.status?(o.success(t.data.msg),n.transitionTo("home",{},{reload:!0})):o.warning(t.data)},function(t){})}}]).controller("AddApiController",["$scope","toastr","$stateParams","$http","$state",function(t,e,o,n,a){t.newApi={params:[],res:[],callbackParams:[]},t.addSchema=formConfig[o.apiIndex].schema,t.addForm=formConfig[o.apiIndex].form,t.addModel=t.newApi,t.docType=o.apiIndex,t.addApi=function(r){n({url:"addApi",method:"POST",data:{name:o.docName,body:t.newApi}}).then(function(t){t.data.status?(e.success(t.data.msg),a.transitionTo("home.doc",{docName:o.docName,apiIndex:0},{reload:!0})):e.warning(t.data.msg)})}}]).controller("delDocumentCtl",["$uibModalInstance","$scope","$stateParams","toastr",function(t,e,o,n){return o.docName?(e.ok=function(){t.close(o.docName)},void(e.cancel=function(){t.dismiss()})):(t.dismiss(),n.warning("请选中要删除的文档"),!1)}]).controller("editApiCtrl",["$scope","$http","toastr","$uibModal","$stateParams","$state",function(t,e,o,n,a,r){e({url:"getDocument",method:"POST",data:{name:a.docName}}).then(function(e){e.data.status?(t.apis=e.data.model.apis[a.apiIndex],t.documentInfo=e.data.model.docInfo,t.editSchema=formConfig[t.documentInfo.type].schema,t.editForm=formConfig[t.documentInfo.type].form,t.editModel=t.apis):o.warning(e.data.msg)}),t.submitAdd=function(n){e({url:"editApi",method:"POST",data:{index:a.apiIndex,name:a.docName,api:t.apis}}).then(function(t){t.data.status?(o.success(t.data.msg),r.transitionTo("home.doc",{docName:a.docName,apiIndex:0},{reload:!0})):o.warning(t.data.msg)})}}]).controller("ErrorController",["$stateParams","$http","$scope",function(t,e,o){o.docname=t.docName,o.errors=[],e({url:"getDocument",method:"POST",data:{name:t.docName}}).then(function(t){t.data.status&&(o.errors=t.data.model.errorCodeLst||[])})}]).controller("EditErrController",["$stateParams","$http","toastr","$scope",function(t,e,o,n){e({url:"getDocument",method:"POST",data:{name:t.docName}}).then(function(t){t.data.status&&(n.errors=t.data.model.errorCodeLst||[])}),n.addErrs=function(){console.log(n.errors),e({url:"editErrorCode",method:"POST",data:{name:t.docName,body:n.errors}}).then(function(t){t.data.status?(o.success("res",t),history.go(-1)):o.warning("服务器异常")})}}]).controller("LoginController",["$scope","$http","$rootScope","toastr","$state",function(t,e,o,n,a){t.login=function(r){r.$valid?e({url:"login",data:t.user,method:"POST"}).then(function(t){console.log(t.data),t.data.status?(sessionStorage.setItem("isLogin",!0),o.isLogin=sessionStorage.isLogin,a.go("home")):n.warning(t.data.msg)}):n.warning("请输入完整登录信息")}}]).controller("editDocInfoCtrl",["$scope","$uibModalInstance","$http","toastr","$stateParams",function(t,e,o,n,a){o({url:"getDocument",method:"POST",data:{name:a.docName}}).then(function(e){e.data.status?(t.documentInfo=e.data.model.docInfo,t.add_model=t.documentInfo):n.warning(e.data.msg)}),t.add_schema={type:"object",properties:{name:{type:"string",title:"name"},type:{type:"string",title:"docType"},description:{type:"string",title:"description"}},required:["name","type"]},t.add_form=["name",{key:"type",type:"select",titleMap:{0:"api",1:"sdk"}},{key:"description",type:"textarea"},{type:"submit",title:"save"}],t.hideModal=function(){e.dismiss()},t.submitAdd=function(r){t.$broadcast("schemaFormValidate"),r.$valid&&r.$dirty?o({url:"editDocs",method:"POST",data:{name:a.docName,info:t.add_model}}).then(function(o){o.data.status?(n.success(o.data.msg),e.close(t.add_model)):(n.warning(o.data.msg),e.dismiss())}):n.warning("请把表单填完整后在提交")}}]),angular.module("app").directive("onErrReady",["$timeout",function(t){return{restrict:"A",link:function(t){t.addErr=function(){var e={name:"",res:"",description:""};t.errors.push(e)},t.delErr=function(e){t.errors.splice(e,1)}}}}]),angular.module("app").filter("docType",function(){return function(t){switch(t){case"0":return"api";case"1":return"sdk"}}});var formConfig=[{schema:{type:"object",properties:{name:{type:"string",title:"请求名称",description:"接口的名称"},api:{type:"string",title:"请求路径",description:"接口路径"},method:{type:"string",title:"请求模式","enum":["POST","GET"]},params:{type:"array",title:"请求头(header)",items:{type:"object",properties:{apiName:{type:"string",title:"参数名称"},type:{type:"string",title:"类型"},require:{type:"string",title:"是否必填","default":"是"},apiValue:{type:"string",title:"说明"}}}},res:{type:"array",title:"请求参数",items:{type:"object",properties:{key:{type:"string",title:"参数名称"},type:{type:"string",title:"类型"},require:{type:"string",title:"是否必填","default":"是"},revalue:{type:"string",title:"说明"}}}},demo:{type:"string",title:"JSON返回示例"},description:{type:"string",title:"接口说明"}}},form:["name","api","method",{key:"params",add:"添加",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:["params[].apiName"]},{type:"section",htmlClass:"col-xs-6",items:["params[].type"]},{type:"section",htmlClass:"col-xs-6",items:["params[].require"]},{type:"section",htmlClass:"col-xs-6",items:["params[].apiValue"]}]}]},{key:"res",add:"添加",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:["res[].key"]},{type:"section",htmlClass:"col-xs-6",items:["res[].type"]},{type:"section",htmlClass:"col-xs-6",items:["res[].require"]},{type:"section",htmlClass:"col-xs-6",items:["res[].revalue"]}]}]},{key:"demo",type:"textarea"},{key:"description",type:"textarea"},{type:"submit",title:"保存"}]}];angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:function(){return"page/list.html?"+Math.random()},controller:"ListController"}).state("home.doc",{url:":docName/:apiIndex",views:{apiContent:{templateUrl:function(){return"page/document.html?"+Math.random()},controller:"MainController"}}}).state("home.edit",{url:":docName/:apiIndex/edit",views:{apiContent:{templateUrl:function(){return"page/form.html?"+Math.random()},controller:"editApiCtrl"}}}).state("home.new",{url:"new",views:{"main-container":{templateUrl:function(){return"page/newDocument.html?"+Math.random()},controller:"NewDocumentController"}}}).state("home.login",{url:"login",views:{"main-container":{templateUrl:function(){return"page/login.html?"+Math.random()},controller:"LoginController"}}}).state("home.newApi",{url:":docName/:apiIndex/newApi",views:{apiContent:{templateUrl:function(){return"page/newApi.html?"+Math.random()},controller:"AddApiController"}}}).state("home.error",{url:":docName/:apiIndex/errCode",views:{apiContent:{templateUrl:function(){return"page/errorCode.html?"+Math.random()},controller:"ErrorController"}}}).state("home.editErr",{url:":docName/edit/err",views:{apiContent:{templateUrl:function(){return"page/errorForm.html?"+Math.random()},controller:"EditErrController"}}});e.otherwise("/")}]),angular.module("app").factory("authorInterceptor",["$log","$injector","$q","$rootScope","$location",function(t,e,o,n,a){var r={request:function(t){return t},response:function(t){return t||o.when(t)},responseError:function(t){return console.log(t),t}};return r}]);